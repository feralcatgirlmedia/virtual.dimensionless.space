<!DOCTYPE html>
<html>
        <link rel="stylesheet" href="css/m3u.css">
<head>
<center>
  <title>m3ustrip</title>
         <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script>
        $(function(){
            $("#footer").load("../footer.html");
        });
    </script>
  <script>
    var importedContents = "";
    var exportedContents = "";

    function handleFileSelect(event) {
      var file = event.target.files[0];
      var reader = new FileReader();

      reader.onload = function(e) {
        importedContents = e.target.result;
        document.getElementById('importedContents').innerText = importedContents;
        convertPlaylist();
      };

      reader.readAsText(file);
    }

    function stripFolderData() {
      var lines = importedContents.split('\n');
      var strippedLines = [];

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();

        if (line.startsWith("#EXTINF:") || line.startsWith("#")) {
          strippedLines.push(line);
        } else {
          var lastIndexUnix = line.lastIndexOf('/');
          var lastIndexWindows = line.lastIndexOf('\\');
          var lastIndex = Math.max(lastIndexUnix, lastIndexWindows);

          if (lastIndex !== -1) {
            var strippedLine = line.substring(lastIndex + 1);
            strippedLines.push(strippedLine);
          } else {
            strippedLines.push(line);
          }
        }
      }

      exportedContents = strippedLines.join('\n');
      document.getElementById('exportedContents').innerText = exportedContents;
    }

    function convertPlaylist() {
      stripFolderData();
    }

    function downloadPlaylist() {
      var filename = document.getElementById('fileInput').files[0].name;
      var newFilename = filename.replace('.m3u', '.stripped.m3u');

      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(exportedContents));
      element.setAttribute('download', newFilename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
    }
  </script>
          <style>
    .column {
      display: inline-block;
      vertical-align: top;
      width: 48%;
    }
  </style>
</head>
<body>
  <h1>m3ustrip</h1>
<h3> The hottest digital (M3U folder metadata) stripper around! </h3>
        <h4> Great for making portable Mixxx playlists! </h4>
                <a href="https://virtual.dimensionless.space/m3ubatch"> Batch version (WIP)</a>
        <p>Select .m3u playlist files to import:
  <input type="file" id="fileInput" accept=".m3u" multiple onchange="handleFileSelect(event)"></p>

  <div class="column">
    <h3>Imported Contents:</h3>
    <pre id="importedContents"></pre>
  </div>
        
  <div class="column">
    <h3>Exported Contents:</h3>
    <pre id="exportedContents"></pre>
  </div>

  <button onclick="downloadPlaylist()">Download</button>
            <div id="footer"></div>
</body>
</html>
